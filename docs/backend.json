{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the K-Square Quotes application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "The user's unique ID from Google authentication."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name as provided by Google."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture from Google, if available.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "displayName"
      ]
    },
    "Quote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quote",
      "type": "object",
      "description": "Represents a quote within the K-Square Quotes application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Quote entity."
        },
        "text": {
          "type": "string",
          "description": "The text content of the quote."
        },
        "themeId": {
          "type": "string",
          "description": "Reference to Theme. (Relationship: Theme 1:N Quote)"
        },
        "backgroundImageURL": {
          "type": "string",
          "description": "URL of the background image associated with the quote.",
          "format": "uri"
        },
        "signature": {
          "type": "string",
          "description": "Signature of the quote. Typically K-Square"
        }
      },
      "required": [
        "id",
        "text",
        "themeId"
      ]
    },
    "Theme": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Theme",
      "type": "object",
      "description": "Represents a theme or category for quotes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Theme entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the theme (e.g., Excellence, Relationships)."
        },
        "description": {
          "type": "string",
          "description": "A description of the theme."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Favorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Favorite",
      "type": "object",
      "description": "Represents a quote that has been favorited by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Favorite entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Favorite)"
        },
        "quoteId": {
          "type": "string",
          "description": "Reference to Quote. (Relationship: Quote 1:N Favorite)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the quote was added to favorites.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "quoteId",
        "createdAt"
      ]
    },
    "RecentlyViewed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecentlyViewed",
      "type": "object",
      "description": "Represents a quote that has been recently viewed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecentlyViewed entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N RecentlyViewed)"
        },
        "quoteId": {
          "type": "string",
          "description": "Reference to Quote. (Relationship: Quote 1:N RecentlyViewed)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the quote was last viewed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "quoteId",
        "timestamp"
      ]
    },
    "AppSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppSetting",
      "type": "object",
      "description": "Represents user-specific settings for the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AppSetting entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 AppSetting)"
        },
        "notificationFrequency": {
          "type": "number",
          "description": "Frequency of quote notifications in hours (e.g., 3 for every 3 hours).",
          "format": "number"
        },
        "darkModeEnabled": {
          "type": "boolean",
          "description": "Indicates whether dark mode is enabled for the user."
        }
      },
      "required": [
        "id",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection for storing user profiles.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/quotes/{quoteId}",
        "definition": {
          "entityName": "Quote",
          "schema": {
            "$ref": "#/backend/entities/Quote"
          },
          "description": "Collection for storing quotes.",
          "params": [
            {
              "name": "quoteId",
              "description": "The unique identifier for the quote."
            }
          ]
        }
      },
      {
        "path": "/themes/{themeId}",
        "definition": {
          "entityName": "Theme",
          "schema": {
            "$ref": "#/backend/entities/Theme"
          },
          "description": "Collection for storing themes.",
          "params": [
            {
              "name": "themeId",
              "description": "The unique identifier for the theme."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": {
            "$ref": "#/backend/entities/Favorite"
          },
          "description": "Subcollection for storing user's favorite quotes. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "favoriteId",
              "description": "The unique identifier for the favorite quote."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recentlyViewed/{recentlyViewedId}",
        "definition": {
          "entityName": "RecentlyViewed",
          "schema": {
            "$ref": "#/backend/entities/RecentlyViewed"
          },
          "description": "Subcollection for storing user's recently viewed quotes. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "recentlyViewedId",
              "description": "The unique identifier for the recently viewed quote."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appSettings/{appSettingId}",
        "definition": {
          "entityName": "AppSetting",
          "schema": {
            "$ref": "#/backend/entities/AppSetting"
          },
          "description": "Subcollection for storing user-specific app settings. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "appSettingId",
              "description": "The unique identifier for the app setting."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence and Structural Segregation. User-owned data (Favorites, RecentlyViewed, AppSettings) is stored under the `/users/{userId}` path, providing clear ownership. Quotes and Themes are stored in top-level collections since these can be considered global data with no owner. This setup avoids hierarchical authorization dependencies by eliminating the need for `get()` calls in security rules. Favorited and Recently Viewed quotes are stored as subcollections under the respective user document to easily find favorites and recently viewed items for that user.  This structure also enables secure `list` operations by segregating user data and global data into separate collections, and following path-based ownership where appropriate."
  }
}